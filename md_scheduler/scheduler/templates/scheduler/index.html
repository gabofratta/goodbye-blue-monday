{% load staticfiles %}
<html>
<head>
	
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<link rel="stylesheet" href="{% static 'css/scheduler.css' %}">
	<link rel="stylesheet" href="//maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css">
	<script src="https://code.jquery.com/jquery-3.3.1.min.js" integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8=" crossorigin="anonymous"></script>
	<script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/js/bootstrap.min.js"></script>
	
	<script>
		$(document).ready(function() {

			$('.close').click(function () {
				// dismiss alert
				$(this).closest('.alert').fadeOut();
				return false;
			});

			$('#prev_program').click(function () {
				//TODO
			});

			$('#next_program').click(function () {
				//TODO
			});

		    $('.act_slot_selector').change(function() {
		    	// display selected slots for each activity
		        $(this).next('.selected_slots').text($(this).val().join(", "));
		    }); 

			$('#add_activity').click(function () {
				// clone an activity line
				var last_activity = $('.activity').last();
				var new_activity = last_activity.clone(true);

				// reset values
				new_activity.find("input[type='text']").val("");
				new_activity.find("span").text("");
				new_activity.find("select.act_slot_selector").val([]);

				// add another line to the form
				new_activity.hide();
				new_activity.find('.remove_activity').removeClass('hidden');
				new_activity.insertAfter(last_activity);
				new_activity.before('<div class="act_spacer spacer20"></div>');
				new_activity.fadeIn();
				return false;
			});    

			$('.remove_activity').click(function () {
				// remove current activity line
				$(this).closest('.activity').fadeOut(400, function () {
					$(this).prev('.act_spacer').remove();
					$(this).closest('.activity').remove();
				});
				return false;
			});

			$('#generate').click(function () {
				var activities = [];
				var valid = true;		

				// iterate over all activities
				$('.activity').each(function(index) {
					// store values
					activities[index] = [];
					activities[index]["code"] = $(this).find('.act_code').val();
					activities[index]["name"] = $(this).find('.act_name').val();
					activities[index]["category"] = $(this).find('.act_category').val();
					activities[index]["year"] = $(this).find('.act_year').val();
					activities[index]["slots"] = $(this).find('.act_slot_selector').val().join(", ");
					activities[index]["_length"] = $(this).find('.act_length').val();

					// validate values
					if (activities[index]["code"] == "" || activities[index]["name"] == "" || activities[index]["category"] == null ||
						activities[index]["year"] == null || activities[index]["slots"] == "" || activities[index]["_length"] == null) {
						// if blank, break and report error
						var err_msg = $('.alert-danger');
						err_msg.find("strong").text("Fill out missing info or remove blank activities.");
						err_msg.fadeIn();
						valid = false;
						return false;
					}
				});

				// should not happen - base activity deleted
				if (activities.length == 0) {
					var err_msg = $('.alert-danger');
					err_msg.find("strong").text("Reload page.");
					err_msg.fadeIn();
					valid = false;
				}

				if (valid) {
					// dismiss alert - error
					$('.alert-danger').fadeOut();

					// TODO - ajax? if valid
				}
				console.log(activities.length)
				return false;
			});

		});
	</script>

</head>

<body>
	{# top menu #}
	<nav class="navbar fixed-top navbar-expand-md navbar-dark bg-teal">
  		<div class="container">
  			<a class="navbar-brand" href="#">MS4 Planner</a>
  			<button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation">
  				<span class="navbar-toggler-icon"></span>
  			</button>
  			<div class="collapse navbar-collapse" id="navbarCollapse">
  				<!-- left navigation links -->
  				<ul class="navbar-nav mr-auto">
  					<!-- active navigation link -->
  					<li class="nav-item active">
  						<a class="nav-link" href="#">Home
  							<span class="sr-only">(current)</span>
  						</a>
  					</li>
  					<!-- regular navigation link -->
  					<li class="nav-item">
  						<a class="nav-link" href="./about">About</a>
  					</li>
  				</ul>
  			</div>
  		</div>
	</nav>

	<main role="main" class="container">
		{# alerts #}
		<div class="alert alert-success alert-custom hidden" role="alert">
				<a href="#" class="close">&times;</a>
				<strong>Success!</strong>
		</div>
		<div class="alert alert-danger alert-custom hidden" role="alert">
				<a href="#" class="close">&times;</a>
				<strong>Error!</strong>
		</div>

		{# calendar #}
		<div id="schedule">

			{# row 1 months #}
			<div class="row">
				{% for month in row_1_months %}
				<div class="col-md-2 month">
					{{ month }}
				</div>
				{% endfor %}
			</div>

			{# row 1 classes #}
			<div class="row">
				{% for month in row_1_activities %}
					<div class="col-md-2 week_block">
					{% for week in month %}
						<div class="week">
							{{ week }}
						</div>
					{% endfor %}
					</div>
				{% endfor %}	
			</div>

			<div class="spacer20"></div>

			{# row 2 headings #}
			<div class="row">
			{% for month in row_2_months %}
				<div class="col-md-2 month">
					{{ month }}
				</div>
			{% endfor %}
			</div>

			{# row 2 classes #}
			<div class="row">
				{% for month in row_2_activities %}			
					<div class="col-md-2 week_block">
					{% for week in month %}
						<div class="week">
							{{ week }}
						</div>
					{% endfor %}
					</div>
				{% endfor %}	
			</div>

			<div class="spacer20"></div>

			{# row 3 headings #}
			<div class="row">
			{% for month in row_3_months %}
				<div class="col-md-2 month">
					{{ month }}
				</div>
			{% endfor %}
			</div>

			{# row 3 classes #}
			<div class="row">
				{% for month in row_3_activities %}			
					<div class="col-md-2 week_block">
					{% for week in month %}
						<div class="week">
							{{ week }}
						</div>
					{% endfor %}
					</div>
				{% endfor %}	
			</div>

		</div>

		{# next, prev navigation #}
		<div class="row">
			<div class="col-md-2">
			</div>
			<div class="col-md-6">
				<a href="#" id="prev_program">&larr; Previous</a>
			</div>
			<div class="col-md-4">
				<a href="#" id="next_program">Next &rarr;</a>
			</div>
		</div>

		<div class="spacer20"></div>
		<hr>
		<div class="spacer20"></div>

		{# data entry section #}
		<div class="container">
			{# section headings #}
			<div class="row activity_header">
				<div class="col-md-1 mb-2">
					<h5>Code</h5>
				</div>
				<div class="col-md-3 mb-2">
					<h5>Name</h5>
				</div>
				<div class="col-md-2 mb-2">
					<h5>Category</h5>
				</div>
				<div class="col-md-2 mb-2">
					<h5>Year</h5>
				</div>
				<div class="col-md-2 mb-2">
					<h5>Starting weeks</h5>
				</div>
				<div class="col-md-2 mb-2">
					<h5>Length</h5>
				</div>
			</div>

			{# data inputs #}
			<div class="activity">
				<div class="row">
					<div class="col-md-1 mb-4">
						<input type="text" class="act_code form-control" style="width:100%;">
					</div>
					<div class="col-md-3 mb-4">
						<input type="text" class="act_name form-control" style="width:100%;">
					</div>
					<div class="col-md-2 mb-4">
						<select class="act_category form-control" style="width:100%;">
							<option value="" disabled selected>Select...</option>
						 	<option value="class">Class</option>
						 	<option value="rotation">Rotation</option>
						  	<option value="custom">Custom</option>
						</select>
					</div>
					<div class="col-md-2 mb-4">
						<select class="act_year form-control" style="width:100%;">
							<option value="" disabled selected>Select...</option>
						 	<option value="{{ fall_year }}">{{ fall_year }}</option>
						 	<option value="{{ spring_year }}">{{ spring_year }}</option>
						</select>
					</div>
					<div class="col-md-2 mb-4">
						<select class="act_slot_selector form-control" multiple>
							{% for week in all_weeks %}
								<option value="{{ week }}">{{ week }}</option>
							{% endfor %}
						</select>
						<span class="selected_slots"></span>
					</div>
					<div class="col-md-2 mb-4">
						<select class="act_length form-control">
							<option value="" disabled selected>Select...</option>
						 	<option value="1">1</option>
						 	<option value="2">2</option>
						  	<option value="3">3</option>
						  	<option value="4">4</option>
						</select>
						<a href="#" class="close remove_activity hidden">&times;</a>
					</div>			
				</div>
			</div>

			{# add line #}
			<div class="row add_link">
				<div class="col-md-0">
					<a href="#" id="add_activity">&plus; Add another</a>
				</div>
			</div>
		</div>

		<div class="spacer20"></div>

		{# generate schedules #}
		<div class="row">
			<div class="col-md-5"></div>
			<div class="col-md-2">
				<button type="button" class="btn btn-info" id="generate">Generate Schedules</button>
			</div>
		</div>

		<div class="spacer50"></div>

	</main>

	<footer>
	</footer>

</body>
</html>